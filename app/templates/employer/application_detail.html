{% extends "employer/employer_base.html" %}
{% block title %}企业首页{% endblock %}
{% block dashboard_content %}
<div class="content-container">
    <div class="page-header">
        <h1 class="page-title">申请详情</h1>
        <a href="{{ url_for('employer.applications') }}" class="btn-view">
            <i class="fas fa-arrow-left"></i> 返回申请列表
        </a>
    </div>

    <div class="application-detail">
        <div class="detail-header">
            <h2 class="detail-title">{{ application.internship_title }}</h2>
            <div class="company-name">{{ application.company_name }}</div>

            <div class="status-container">
                <span class="status-badge
                    {% if application.status == 'submitted' %}status-submitted
                    {% elif application.status == 'reviewed' %}status-reviewed
                    {% elif application.status == 'accepted' %}status-accepted
                    {% else %}status-rejected{% endif %}">
                    {% if application.status == 'submitted' %}已提交
                    {% elif application.status == 'reviewed' %}已查看
                    {% elif application.status == 'accepted' %}已录取
                    {% else %}未录取{% endif %}
                </span>

                <div class="meta-item">
                    <i class="fas fa-calendar-alt"></i> 申请时间: {{ application.applied_at.strftime('%Y-%m-%d %H:%M') }}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="section-title">申请人信息</div>
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-4">
                            <div class="avatar-container mr-3">
                                {% if application.profile_image %}
                                <img src="{{ url_for('static', filename='uploads/' + application.profile_image) }}" alt="头像">
                                {% else %}
                                <div class="student-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                {% endif %}
                            </div>
                            <div>
                                <h4>{{ application.student_name }}</h4>
                                <p>{{ application.university }} · {{ application.course }}</p>
                                <p><i class="fas fa-envelope"></i> {{ application.student_email }}</p>
                            </div>
                        </div>

                        <div class="resume-section">
                            <div class="resume-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="resume-info">
                                <div class="resume-name">个人简历.pdf</div>
                                <div class="text-muted">最后更新: {{ application.applied_at.strftime('%Y-%m-%d') }}</div>
                            </div>
                            <a href="{{ url_for('static', filename='uploads/' + application.resume_path) }}"
                               class="btn-download" download>
                                <i class="fas fa-download"></i> 下载简历
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section-title">申请状态</div>

                {% if application.status == 'accepted' %}
                <div class="alert alert-success">
                    <i class="fas fa-check-circle mr-2"></i> 该申请已被接受
                    {% if application.feedback %}
                    <div class="mt-2">
                        <strong>反馈:</strong> {{ application.feedback }}
                    </div>
                    {% endif %}
                </div>
                {% elif application.status == 'rejected' %}
                <div class="alert alert-danger">
                    <i class="fas fa-times-circle mr-2"></i> 该申请已被拒绝
                    {% if application.feedback %}
                    <div class="mt-2">
                        <strong>反馈:</strong> {{ application.feedback }}
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <form method="POST" action="{{ url_for('employer.application_detail', application_id=application.application_id) }}">
                    <div class="form-group">
                        <label for="action">更新申请状态</label>
                        <div class="d-flex">
                            <button type="submit" name="action" value="accept" class="btn-accept mr-2">
                                <i class="fas fa-check mr-1"></i> 接受申请
                            </button>
                            <button type="submit" name="action" value="reject" class="btn-reject">
                                <i class="fas fa-times mr-1"></i> 拒绝申请
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="feedback">反馈意见 (可选)</label>
                        <textarea class="form-control" id="feedback" name="feedback"
                                  rows="4" placeholder="请输入反馈意见...">{{ application.feedback or '' }}</textarea>
                    </div>
                </form>
                {% endif %}

                <div class="timeline mt-4">
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-date">{{ application.applied_at.strftime('%Y-%m-%d %H:%M') }}</div>
                            <div class="timeline-title">申请已提交</div>
                            <div class="timeline-text">申请人提交了实习申请</div>
                        </div>
                    </div>

                    {% if application.status == 'reviewed' or application.status == 'accepted' or application.status == 'rejected' %}
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-date">
                                {{ (application.applied_at + timedelta(days=1)).strftime('%Y-%m-%d %H:%M') }}
                            </div>
                            <div class="timeline-title">申请已查看</div>
                            <div class="timeline-text">招聘人员已查看申请</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if application.status == 'accepted' %}
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-date">
                                {{ (application.applied_at + timedelta(days=2)).strftime('%Y-%m-%d %H:%M') }}
                            </div>
                            <div class="timeline-title">申请已接受</div>
                            <div class="timeline-text">申请已被接受</div>
                        </div>
                    </div>
                    {% elif application.status == 'rejected' %}
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-date">
                                {{ (application.applied_at + timedelta(days=2)).strftime('%Y-%m-%d %H:%M') }}
                            </div>
                            <div class="timeline-title">申请已拒绝</div>
                            <div class="timeline-text">申请已被拒绝</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="section-title">实习岗位详情</div>
        <div class="section-content">
            <h5>{{ application.internship_title }}</h5>
            <p>{{ application.internship_description }}</p>
        </div>
    </div>
</div>
{% endblock %}